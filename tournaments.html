<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tournaments - WalletWars</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <!-- CRITICAL: Solana Web3.js - MUST LOAD FIRST -->
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    
    <!-- WalletWars Scripts - ENHANCED ORDER WITH GLOBAL WALLET MANAGER -->
    <script src="walletwars-api.js"></script>
    <script src="wallet-service.js"></script> <!-- Enhanced wallet service -->
    <script src="global-wallet-manager.js"></script> <!-- NEW: Global wallet persistence -->
    <script src="tournament-setup.js"></script>

    <!-- Escrow Integration Scripts -->
    <script src="https://unpkg.com/buffer@6.0.3/index.js"></script>
    <script src="https://unpkg.com/@project-serum/anchor@latest/dist/browser/index.js"></script>
    <script src="walletwars-escrow-integration.js"></script>
    
    <!-- Hybrid Snapshot System Scripts -->
    <script src="tournament-snapshot-manager.js"></script>
    <script src="tournament-automation.js"></script>
    
    <!-- Tournament System Scripts -->
    <script src="js/tournament-system/tournament-config.js"></script>
    <script src="js/tournament-system/tournament-test-mode.js"></script>
    <script src="js/tournament-system/tournament-snapshot-manager.js"></script>
    <script src="js/tournament-system/tournament-lifecycle-manager.js"></script>
    <script src="js/tournament-system/tournament-deployment-manager.js"></script>
    <script src="js/tournament-system/tournament-automation.js"></script>
    <script src="js/tournament-system/tournament-system-init.js"></script>s/tournament-system/tournament-system-init.js"></script>
    
    <!-- Shared Styles -->
    <link rel="stylesheet" href="shared.css">
    
    <style>
        /* Tournaments Specific Styles */
        .tournaments-title {
            background: linear-gradient(135deg, #8b5cf6, #ec4899, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Loading State */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 4rem 2rem;
            text-align: center;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(139, 92, 246, 0.2);
            border-top: 4px solid #8b5cf6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #8b5cf6;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .loading-subtext {
            color: #9ca3af;
            font-size: 0.9rem;
        }

        /* Error State */
        .error-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 4rem 2rem;
            text-align: center;
        }

        .error-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            color: #ef4444;
        }

        .error-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ef4444;
            margin-bottom: 0.5rem;
        }

        .error-message {
            color: #9ca3af;
            margin-bottom: 2rem;
            max-width: 400px;
        }

        .retry-btn {
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
            border: none;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .retry-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(139, 92, 246, 0.4);
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            z-index: 1001;
        }

        .hamburger {
            width: 24px;
            height: 20px;
            position: relative;
            transform: rotate(0deg);
            transition: 0.3s ease-in-out;
        }

        .hamburger span {
            display: block;
            position: absolute;
            height: 3px;
            width: 100%;
            background: #8b5cf6;
            border-radius: 3px;
            opacity: 1;
            left: 0;
            transform: rotate(0deg);
            transition: 0.25s ease-in-out;
        }

        .hamburger span:nth-child(1) {
            top: 0px;
        }

        .hamburger span:nth-child(2) {
            top: 8px;
        }

        .hamburger span:nth-child(3) {
            top: 16px;
        }

        .hamburger.active span:nth-child(1) {
            top: 8px;
            transform: rotate(135deg);
        }

        .hamburger.active span:nth-child(2) {
            opacity: 0;
            left: -60px;
        }

        .hamburger.active span:nth-child(3) {
            top: 8px;
            transform: rotate(-135deg);
        }

        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
            }

            .nav-links {
                position: fixed;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100vh;
                background: rgba(10, 10, 10, 0.95);
                backdrop-filter: blur(20px);
                flex-direction: column;
                justify-content: center;
                align-items: center;
                gap: 2rem;
                transition: left 0.3s ease;
                z-index: 1000;
            }

            .nav-links.active {
                left: 0;
            }

            .nav-links a {
                font-size: 1.2rem;
                padding: 1rem 2rem;
            }

            .btn-primary {
                margin-left: 0;
                margin-top: 1rem;
            }
        }

        /* Enhanced Filter Section for Tiered System */
        .tournament-filters {
            background: rgba(31, 41, 55, 0.3);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 1rem;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .filter-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 0.5rem;
            background: rgba(139, 92, 246, 0.1);
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .filter-toggle-text {
            font-weight: 600;
            color: #8b5cf6;
            font-size: 0.95rem;
        }

        .filter-toggle-icon {
            color: #8b5cf6;
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .filter-toggle.active .filter-toggle-icon {
            transform: rotate(180deg);
        }

        .filter-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .filter-content.active {
            max-height: 500px;
        }

        .filter-group {
            margin-bottom: 0.75rem;
            padding: 0.5rem 0;
        }

        .filter-group:last-child {
            margin-bottom: 0;
        }

        .filter-label {
            font-weight: 600;
            color: #8b5cf6;
            margin-bottom: 0.5rem;
            display: block;
            font-size: 0.85rem;
        }

        .filter-buttons {
            display: flex;
            gap: 0.4rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            background: rgba(31, 41, 55, 0.5);
            border: 1px solid rgba(139, 92, 246, 0.3);
            color: #d1d5db;
            padding: 0.4rem 0.8rem;
            border-radius: 0.4rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            font-weight: 500;
            min-height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .filter-btn:hover,
        .filter-btn.active {
            background: rgba(139, 92, 246, 0.2);
            border-color: #8b5cf6;
            color: #8b5cf6;
            transform: translateY(-1px);
        }

        /* Desktop filter styling */
        @media (min-width: 768px) {
            .tournament-filters {
                padding: 1rem 1.5rem;
            }

            .filter-toggle {
                padding: 0.75rem 1rem;
                background: rgba(139, 92, 246, 0.15);
                border: 1px solid rgba(139, 92, 246, 0.3);
            }

            .filter-toggle-text {
                font-size: 1rem;
                font-weight: 700;
            }

            .filter-toggle-icon {
                font-size: 1.3rem;
            }

            .filter-content.active {
                max-height: 600px;
            }

            .filter-groups-container {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1.5rem;
                align-items: start;
                padding-top: 0.5rem;
            }

            .filter-group {
                margin-bottom: 0;
                padding: 0;
            }

            .filter-label {
                font-size: 0.9rem;
                margin-bottom: 0.75rem;
                font-weight: 700;
            }

            .filter-buttons {
                gap: 0.5rem;
            }

            .filter-btn {
                padding: 0.5rem 1rem;
                font-size: 0.85rem;
                min-height: 38px;
                border-radius: 0.5rem;
            }

            .filter-btn:hover,
            .filter-btn.active {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
            }
        }

        /* Tournament Cards - Enhanced for Tiers */
        .tournaments-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
            perspective: 1000px;
        }

        .tournament-card {
            background: transparent;
            border: none;
            border-radius: 1rem;
            padding: 0;
            transition: all 0.6s ease;
            position: relative;
            overflow: visible;
            cursor: pointer;
            transform-style: preserve-3d;
            min-height: 260px;
            z-index: 1;
        }

        .tournament-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 40px rgba(139, 92, 246, 0.3);
        }

        .card-front {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            padding: 1.25rem;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            background: rgba(31, 41, 55, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 1rem;
            box-sizing: border-box;
        }

        .tournament-header-compact {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
            width: 100%;
            box-sizing: border-box;
        }

        .tournament-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 0.25rem;
            font-family: 'Orbitron', monospace;
            line-height: 1.2;
        }

        .tournament-subtitle {
            font-size: 0.8rem;
            color: #9ca3af;
            margin-bottom: 0.75rem;
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .status-badge {
            padding: 0.3rem 0.6rem;
            border-radius: 1rem;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            flex-shrink: 0;
        }

        .status-upcoming {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            border: 1px solid #3b82f6;
        }

        .status-live {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid #10b981;
        }

        .status-registering {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid #10b981;
        }

        .status-active {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            border: 1px solid #fbbf24;
        }

        /* Enhanced Key Info Grid */
        .key-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            width: 100%;
            box-sizing: border-box;
        }

        .key-info-item {
            text-align: center;
            padding: 0.4rem;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 0.4rem;
            border: 1px solid rgba(139, 92, 246, 0.1);
            min-height: 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-sizing: border-box;
        }

        .key-info-label {
            color: #9ca3af;
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.15rem;
            line-height: 1;
        }

        .key-info-value {
            color: #8b5cf6;
            font-weight: 700;
            font-size: 0.8rem;
            line-height: 1;
        }

        .prize-highlight {
            color: #ffd700 !important;
            font-weight: 700 !important;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        .tap-hint {
            text-align: center;
            color: #6b7280;
            font-size: 0.65rem;
            margin-top: 0.5rem;
            padding: 0 0.5rem;
            box-sizing: border-box;
            line-height: 1.2;
        }

        /* Tier-specific styling */
        .tier-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.4rem;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .tier-bronze {
            background: rgba(205, 127, 50, 0.2);
            color: #cd7f32;
            border: 1px solid rgba(205, 127, 50, 0.3);
        }

        .tier-silver {
            background: rgba(192, 192, 192, 0.2);
            color: #c0c0c0;
            border: 1px solid rgba(192, 192, 192, 0.3);
        }

        .tier-gold {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .tier-diamond {
            background: rgba(185, 242, 255, 0.2);
            color: #b9f2ff;
            border: 1px solid rgba(185, 242, 255, 0.3);
        }

        .monthly-badge {
            background: rgba(139, 92, 246, 0.2);
            color: #8b5cf6;
            border: 1px solid rgba(139, 92, 246, 0.3);
            font-weight: 700;
            animation: pulse 2s infinite;
        }

        .trading-badge {
            display: inline-block;
            padding: 0.2rem 0.4rem;
            border-radius: 0.3rem;
            font-size: 0.65rem;
            font-weight: 600;
        }

        .trading-badge.pure_wallet {
            background: rgba(6, 182, 212, 0.2);
            color: #06b6d4;
            border: 1px solid rgba(6, 182, 212, 0.3);
        }

        .trading-badge.open_trading {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .schedule-badge {
            display: inline-block;
            padding: 0.2rem 0.4rem;
            border-radius: 0.3rem;
            font-size: 0.65rem;
            font-weight: 600;
            background: rgba(139, 92, 246, 0.2);
            color: #8b5cf6;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        /* Tournament Registration Modal - Enhanced */
        .tournament-registration-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal-content {
            background: rgba(31, 41, 55, 0.95);
            backdrop-filter: blur(30px);
            border: 2px solid rgba(139, 92, 246, 0.4);
            border-radius: 1.5rem;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-content h2 {
            color: #8b5cf6;
            margin-bottom: 1rem;
            font-family: 'Orbitron', monospace;
        }

        .tournament-tier-info {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 0.75rem;
            padding: 1rem;
            margin: 1rem 0;
        }

        .tier-display {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .tier-icon {
            font-size: 2rem;
        }

        .tier-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: #8b5cf6;
        }

        .tier-description {
            font-size: 0.9rem;
            color: #9ca3af;
        }

        .tournament-info {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 0.75rem;
            padding: 1rem;
            margin: 1rem 0;
        }

        .tournament-info p {
            margin: 0.5rem 0;
            color: #d1d5db;
        }

        .prize-breakdown {
            background: rgba(15, 23, 42, 0.3);
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
        }

        .prize-breakdown h4 {
            color: #8b5cf6;
            margin-bottom: 0.5rem;
        }

        .prize-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.25rem 0;
            border-bottom: 1px solid rgba(139, 92, 246, 0.1);
        }

        .prize-item:last-child {
            border-bottom: none;
        }

        .place {
            flex: 1;
            color: #d1d5db;
        }

        .prize {
            flex: 1;
            text-align: center;
            color: #ffd700;
            font-weight: 600;
        }

        .percentage {
            flex: 0 0 auto;
            color: #9ca3af;
            font-size: 0.8rem;
        }

        .warning-box {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
        }

        .warning-box p {
            color: #ef4444;
            margin: 0;
        }

        .success-box {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
        }

        .success-box p {
            color: #10b981;
            margin: 0.25rem 0;
        }

        .registration-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .registration-actions button {
            flex: 1;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .registration-actions button:first-child {
            background: rgba(31, 41, 55, 0.5);
            border: 1px solid rgba(139, 92, 246, 0.3);
            color: #d1d5db;
        }

        .registration-actions button:first-child:hover {
            background: rgba(139, 92, 246, 0.1);
            border-color: #8b5cf6;
            color: #8b5cf6;
        }

        .register-btn {
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
            border: none;
            color: white;
        }

        .register-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(139, 92, 246, 0.4);
        }

        .register-btn.tier-bronze {
            background: linear-gradient(135deg, #cd7f32, #8b4513);
        }

        .register-btn.tier-silver {
            background: linear-gradient(135deg, #c0c0c0, #708090);
        }

        .register-btn.tier-gold {
            background: linear-gradient(135deg, #ffd700, #ff8c00);
        }

        .register-btn.tier-diamond {
            background: linear-gradient(135deg, #b9f2ff, #00bfff);
        }

        /* Tablet and Desktop */
        @media (min-width: 768px) {
            .tournaments-grid {
                grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
                gap: 1.5rem;
            }

            .tournament-card {
                min-height: 280px;
            }

            .card-front {
                padding: 1.5rem;
            }

            .tournament-header-compact {
                margin-bottom: 1rem;
            }

            .tournament-title {
                font-size: 1.2rem;
                margin-bottom: 0.3rem;
            }

            .tournament-subtitle {
                font-size: 0.85rem;
                margin-bottom: 0.75rem;
            }

            .status-badge {
                padding: 0.35rem 0.7rem;
                font-size: 0.75rem;
            }

            .key-info {
                gap: 0.6rem;
                margin-bottom: 0.75rem;
            }

            .key-info-item {
                padding: 0.5rem;
                min-height: 55px;
                border-radius: 0.5rem;
            }

            .key-info-label {
                font-size: 0.7rem;
                margin-bottom: 0.2rem;
            }

            .key-info-value {
                font-size: 0.85rem;
            }

            .tier-badge {
                padding: 0.25rem 0.5rem;
                font-size: 0.7rem;
                border-radius: 0.4rem;
            }
        }

        @media (min-width: 1024px) {
            .tournaments-grid {
                grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
                gap: 2rem;
            }

            .tournament-card {
                padding: 2rem;
            }

            .card-front {
                padding: 2rem;
            }
        }

        /* Hybrid Snapshot Status */
        .snapshot-status {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .snapshot-status-icon {
            font-size: 1.5rem;
        }

        .snapshot-status-text {
            flex: 1;
        }

        .snapshot-status-title {
            color: #10b981;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .snapshot-status-desc {
            color: #d1d5db;
            font-size: 0.85rem;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        /* Admin Mode Styles */
.admin-mode-toggle {
    position: fixed;
    top: 80px;
    right: 20px;
    z-index: 999;
    background: rgba(139, 92, 246, 0.1);
    border: 1px solid rgba(139, 92, 246, 0.3);
    border-radius: 0.75rem;
    padding: 0.5rem 1rem;
    display: none;
}

.admin-toggle-btn {
    background: none;
    border: none;
    color: #8b5cf6;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.admin-toggle-btn:hover {
    color: #a78bfa;
}

/* Admin Create Tournament Button */
.admin-create-section {
    background: rgba(139, 92, 246, 0.1);
    border: 2px dashed rgba(139, 92, 246, 0.3);
    border-radius: 1rem;
    padding: 2rem;
    margin-bottom: 2rem;
    text-align: center;
    display: none;
}

.create-tournament-btn {
    background: linear-gradient(135deg, #8b5cf6, #ec4899);
    border: none;
    color: white;
    padding: 1rem 2rem;
    border-radius: 0.75rem;
    font-size: 1.1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.create-tournament-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(139, 92, 246, 0.4);
}

/* Tournament Creation Modal */
.admin-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(20px);
    z-index: 3000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
}

.admin-modal-content {
    background: rgba(31, 41, 55, 0.95);
    backdrop-filter: blur(30px);
    border: 2px solid rgba(139, 92, 246, 0.4);
    border-radius: 1.5rem;
    padding: 2rem;
    max-width: 700px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
}

.admin-modal h2 {
    color: #8b5cf6;
    margin-bottom: 1.5rem;
    font-family: 'Orbitron', monospace;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    color: #d1d5db;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    background: rgba(15, 23, 42, 0.5);
    border: 1px solid rgba(139, 92, 246, 0.3);
    color: #ffffff;
    padding: 0.75rem 1rem;
    border-radius: 0.5rem;
    font-size: 1rem;
    transition: all 0.3s ease;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #8b5cf6;
    background: rgba(15, 23, 42, 0.7);
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.form-actions {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
}

.form-actions button {
    flex: 1;
    padding: 0.75rem 1rem;
    border-radius: 0.75rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-cancel {
    background: rgba(31, 41, 55, 0.5);
    border: 1px solid rgba(139, 92, 246, 0.3);
    color: #d1d5db;
}

.btn-cancel:hover {
    background: rgba(139, 92, 246, 0.1);
    border-color: #8b5cf6;
    color: #8b5cf6;
}

.btn-create {
    background: linear-gradient(135deg, #8b5cf6, #ec4899);
    border: none;
    color: white;
}

.btn-create:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(139, 92, 246, 0.4);
}

.tier-selector {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 0.5rem;
    margin-top: 0.5rem;
}

.tier-option {
    background: rgba(15, 23, 42, 0.5);
    border: 2px solid rgba(139, 92, 246, 0.2);
    border-radius: 0.5rem;
    padding: 0.75rem;
    cursor: pointer;
    text-align: center;
    transition: all 0.3s ease;
}

.tier-option:hover {
    background: rgba(139, 92, 246, 0.1);
    border-color: rgba(139, 92, 246, 0.5);
}

.tier-option.selected {
    background: rgba(139, 92, 246, 0.2);
    border-color: #8b5cf6;
}

.tier-option .tier-icon {
    font-size: 1.5rem;
    margin-bottom: 0.25rem;
}

.tier-option .tier-name {
    font-size: 0.9rem;
    font-weight: 600;
}

.info-box {
    background: rgba(6, 182, 212, 0.1);
    border: 1px solid rgba(6, 182, 212, 0.3);
    border-radius: 0.5rem;
    padding: 1rem;
    margin: 1rem 0;
}

.info-box p {
    color: #06b6d4;
    margin: 0;
    font-size: 0.9rem;
}

@media (max-width: 768px) {
    .admin-mode-toggle {
        top: 70px;
        right: 10px;
    }
    
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .tier-selector {
        grid-template-columns: repeat(2, 1fr);
    }
    /* Scheduled tournament card styling */
.tournament-card.scheduled {
    opacity: 0.9;
    border: 1px solid rgba(139, 92, 246, 0.2);
}

.tournament-card.scheduled:hover {
    opacity: 1;
    border-color: rgba(139, 92, 246, 0.4);
}

/* Enhanced status badges */
.status-upcoming {
    background: rgba(156, 163, 175, 0.2);
    color: #9ca3af;
    border: 1px solid #9ca3af;
}

.status-upcoming.opens-soon {
    background: rgba(251, 191, 36, 0.2);
    color: #fbbf24;
    border: 1px solid #fbbf24;
    animation: pulse 2s infinite;
}

/* Registration countdown styling */
.registration-timer {
    font-size: 0.75rem;
    color: #fbbf24;
    margin-top: 0.25rem;
    font-weight: 600;
}

/* "Coming Soon" overlay for scheduled tournaments */
.coming-soon-overlay {
    position: absolute;
    top: 0;
    right: 0;
    background: rgba(139, 92, 246, 0.9);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 0 1rem 0 1rem;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Tooltip styling for status badges */
.status-badge {
    position: relative;
    cursor: help;
}

.status-badge[title]:hover::after {
    content: attr(title);
    position: absolute;
    bottom: 125%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(31, 41, 55, 0.95);
    color: #d1d5db;
    padding: 0.5rem 0.75rem;
    border-radius: 0.5rem;
    white-space: nowrap;
    font-size: 0.75rem;
    z-index: 10;
    pointer-events: none;
}

/* Visual hierarchy - make open tournaments stand out more */
.tournament-card.status-registering {
    border: 2px solid rgba(16, 185, 129, 0.4);
    box-shadow: 0 0 20px rgba(16, 185, 129, 0.1);
}

.tournament-card.status-registering:hover {
    border-color: rgba(16, 185, 129, 0.6);
    box-shadow: 0 0 30px rgba(16, 185, 129, 0.2);
}
        
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="animated-background"></div>
    <div class="geometric-patterns"></div>

    <!-- Navigation with Global Wallet Manager Support -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">WalletWars</a>
            
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="tournaments.html" class="active">Tournaments</a></li>
                <li><a href="leaderboards.html">Leaderboards</a></li>
                <li><a href="hall-of-fame.html">Hall of Fame</a></li>
                <li><a href="profile.html">Profile</a></li>
                
                <!-- Disconnected State -->
                <li id="connectWalletBtn"><a href="#" class="btn-primary" onclick="window.connectWallet && window.connectWallet('phantom') || fallbackConnect()">Connect Wallet</a></li>
                
                <!-- Connected State (Hidden by default, managed by GlobalWalletManager) -->
                <li id="championInfo" style="display: none;">
                    <div id="navChampionAvatar">üî•</div>
                    <span id="navChampionName">Champion</span>
                    <button class="nav-disconnect" onclick="window.disconnectWallet && window.disconnectWallet()">Disconnect</button>
                </li>
            </ul>

            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-toggle" aria-label="Toggle mobile menu" aria-expanded="false">
                <div class="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </button>
        </div>
    </nav>

    <div class="admin-mode-toggle" id="adminModeToggle">
    <button class="admin-toggle-btn" onclick="toggleAdminMode()">
        üëë Admin Mode: <span id="adminModeStatus">OFF</span>
    </button>
    </div>
    
    <!-- Page Container -->
    <div class="page-container">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title tournaments-title">Tournaments</h1>
            <p class="page-subtitle">Compete in tiered tournaments with escalating stakes and massive prizes</p>
        </div>

        <!-- Page Content -->
        <div class="page-content">
            <!-- Hybrid Snapshot Status -->
            <div class="snapshot-status" id="snapshotStatus" style="display: none;">
                <div class="snapshot-status-icon">üì∏</div>
                <div class="snapshot-status-text">
                    <div class="snapshot-status-title">Tiered Tournament System Active</div>
                    <div class="snapshot-status-desc">Bronze ‚Üí Silver ‚Üí Gold ‚Üí Diamond progression with monthly mega tournaments</div>
                </div>
            </div>

            <!-- Loading State -->
            <div class="loading-container" id="loadingState">
                <div class="loading-spinner"></div>
                <div class="loading-text">Loading Tiered Tournaments...</div>
                <div class="loading-subtext">Fetching tournament data with escalating stakes system</div>
            </div>

            <!-- Error State -->
            <div class="error-container" id="errorState" style="display: none;">
                <div class="error-icon">üö´</div>
                <div class="error-title">Unable to Load Tournaments</div>
                <div class="error-message" id="errorMessage">
                    Failed to connect to the database. Please check your internet connection and try again.
                </div>
                <button class="retry-btn" onclick="loadTournaments()">Retry</button>
            </div>

            <!-- Main Content -->
            <div id="mainContent" style="display: none;">
            <!-- Admin Create Tournament Section -->
                <div class="admin-create-section" id="adminCreateSection">
                    <button class="create-tournament-btn" onclick="showCreateTournamentModal()">
                        ‚ûï Create New Tournament
                    </button>
                </div>
                
                <!-- Enhanced Tournament Filters for Tiers -->
                <div class="tournament-filters">
                    <div class="filter-toggle" onclick="toggleFilters()">
                        <span class="filter-toggle-text">üéØ Filters & Tiers</span>
                        <span class="filter-toggle-icon">‚ñº</span>
                    </div>
                    
                    <div class="filter-content" id="filterContent">
                        <div class="filter-groups-container">
                            <div class="filter-group">
                                <label class="filter-label">Tournament Tier</label>
                                <div class="filter-buttons tier-filter-buttons">
                                    <button class="filter-btn active" onclick="filterByTier('all')">All</button>
                                    <button class="filter-btn" onclick="filterByTier('bronze')">ü•â Bronze</button>
                                    <button class="filter-btn" onclick="filterByTier('silver')">ü•à Silver</button>
                                    <button class="filter-btn" onclick="filterByTier('gold')">ü•á Gold</button>
                                    <button class="filter-btn" onclick="filterByTier('diamond')">üíé Diamond</button>
                                    <button class="filter-btn" onclick="filterByTier('monthly')">üèÜ Monthly</button>
                                </div>
                            </div>
                            
                            <div class="filter-group">
                                <label class="filter-label">Trading Style</label>
                                <div class="filter-buttons">
                                    <button class="filter-btn active" onclick="filterByTradingStyle('all')">All</button>
                                    <button class="filter-btn" onclick="filterByTradingStyle('pure_wallet')">üìä Pure Wallet</button>
                                    <button class="filter-btn" onclick="filterByTradingStyle('open_trading')">‚ö° Open Trading</button>
                                </div>
                            </div>

                            <div class="filter-group">
                                <label class="filter-label">Entry Fee Range</label>
                                <div class="filter-buttons">
                                    <button class="filter-btn active" onclick="filterByFee('all')">All</button>
                                    <button class="filter-btn" onclick="filterByFee('low')">0.01 SOL</button>
                                    <button class="filter-btn" onclick="filterByFee('medium')">0.05 SOL</button>
                                    <button class="filter-btn" onclick="filterByFee('high')">0.1+ SOL</button>
                                </div>
                            </div>

                            <div class="filter-group">
                                <label class="filter-label">Status</label>
                                <div class="filter-buttons">
                                    <button class="filter-btn active" onclick="filterByStatus('all')">All</button>
                                    <button class="filter-btn" onclick="filterByStatus('upcoming')">Upcoming</button>
                                    <button class="filter-btn" onclick="filterByStatus('registering')">Open</button>
                                    <button class="filter-btn" onclick="filterByStatus('active')">Live</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tournament Grid -->
                <div class="tournaments-grid" id="tournamentsGrid">
                    <!-- Tournament cards will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ========================================
        // GLOBAL VARIABLES FOR TIERED SYSTEM
        // ========================================
        var tournamentData = {};
        var realTournamentData = [];
        var championData = {
            championId: null,
            championName: null,
            isConnected: false
        };
        var isLoading = false;
        var currentFilter = {
            tier: 'all',
            tradingStyle: 'all',
            fee: 'all',
            status: 'all'
        };

        // ========================================
        // GLOBAL WALLET MANAGER INTEGRATION
        // ========================================

        function fallbackConnect() {
            alert('üîó Wallet Connection\n\nWallet system is loading. Please try again in a moment, or visit the home page to connect your wallet.');
        }

        function checkGlobalWalletConnection() {
            if (window.getWalletStatus) {
                const status = window.getWalletStatus();
                if (status.isConnected && status.championName) {
                    console.log(`‚úÖ GlobalWalletManager: Found connected champion ${status.championName}`);
                    
                    championData = {
                        championId: status.championId,
                        championName: status.championName,
                        isConnected: true,
                        walletAddress: status.walletAddress,
                        avatar: status.avatar
                    };
                    
                    return true;
                }
            }
            return false;
        }

        function checkTieredTournamentSystem() {
            if (window.TOURNAMENT_CONFIG && window.TieredTournamentSelector) {
                console.log('‚úÖ Tiered Tournament System detected');
                document.getElementById('snapshotStatus').style.display = 'flex';
                
                // Log tier configuration
                console.log('üéØ Tournament Tiers:', Object.keys(window.TOURNAMENT_CONFIG.weeklyTiers));
                
                return true;
            }
            return false;
        }

        // ========================================
        // MOBILE NAVIGATION
        // ========================================

        function initializeMobileNavigation() {
            const mobileToggle = document.querySelector('.mobile-menu-toggle');
            const navLinks = document.querySelector('.nav-links');
            const hamburger = document.querySelector('.hamburger');
            
            if (!mobileToggle || !navLinks || !hamburger) return;
            
            mobileToggle.addEventListener('click', function() {
                const isOpen = navLinks.classList.contains('active');
                if (isOpen) {
                    closeMobileMenu();
                } else {
                    openMobileMenu();
                }
            });
            
            const navLinksItems = navLinks.querySelectorAll('a');
            navLinksItems.forEach(link => {
                link.addEventListener('click', function() {
                    closeMobileMenu();
                });
            });
            
            document.addEventListener('click', function(event) {
                const isClickInsideNav = navLinks.contains(event.target) || 
                                        mobileToggle.contains(event.target);
                if (!isClickInsideNav && navLinks.classList.contains('active')) {
                    closeMobileMenu();
                }
            });
        }

        function openMobileMenu() {
            const mobileToggle = document.querySelector('.mobile-menu-toggle');
            const navLinks = document.querySelector('.nav-links');
            const hamburger = document.querySelector('.hamburger');
            
            navLinks.classList.add('active');
            hamburger.classList.add('active');
            mobileToggle.setAttribute('aria-expanded', 'true');
            document.body.style.overflow = 'hidden';
        }

        function closeMobileMenu() {
            const mobileToggle = document.querySelector('.mobile-menu-toggle');
            const navLinks = document.querySelector('.nav-links');
            const hamburger = document.querySelector('.hamburger');
            
            navLinks.classList.remove('active');
            hamburger.classList.remove('active');
            mobileToggle.setAttribute('aria-expanded', 'false');
            document.body.style.overflow = '';
        }

        function handleWindowResize() {
            window.addEventListener('resize', function() {
                if (window.innerWidth >= 768) {
                    closeMobileMenu();
                }
            });
        }

        // ========================================
        // TIERED TOURNAMENT LOADING
        // ========================================

async function loadTournaments() {
    if (isLoading) return;
    
    isLoading = true;
    showLoadingState();
    
    try {
        console.log('üéÆ Loading tiered tournaments with enhanced system...');
        
        // Check if WalletWars API is available
        if (!window.walletWarsAPI) {
            console.error('‚ùå WalletWars API not available');
            throw new Error('WalletWars API not available. Please refresh the page.');
        }
        
        // Test connection first
        try {
            const connected = await window.walletWarsAPI.testConnection();
            if (!connected) {
                throw new Error('Database connection failed');
            }
        } catch (connError) {
            console.error('‚ùå Connection test failed:', connError);
            throw new Error('Cannot connect to database. Please check your internet connection.');
        }
        
        // Check tiered system status (optional, don't fail if missing)
        if (window.checkTieredTournamentSystem) {
            checkTieredTournamentSystem();
        }
        
        // Check wallet connection status (optional)
        if (window.globalWalletManager && window.getWalletStatus) {
            const globalStatus = window.getWalletStatus();
            console.log(`üîó GlobalWalletManager status: ${globalStatus.isConnected ? 'Connected' : 'Disconnected'}`);
        }
        
        // Get tournaments
        const result = await window.walletWarsAPI.getUpcomingTournaments(50);
        
        if (result.success) {
            // UPDATED FILTER: Include scheduled tournaments that are coming soon
            const now = new Date();
            const twoWeeksFromNow = new Date(now.getTime() + 14 * 24 * 60 * 60 * 1000); // Show tournaments up to 2 weeks out
            
            const upcomingTournaments = result.tournaments.filter(t => {
                // Include if status is suitable
                const validStatus = t.status === 'scheduled' || 
                                  t.status === 'registering' || 
                                  t.status === 'pending_start' ||
                                  t.status === 'active';
                
                // Only show scheduled tournaments that start within 2 weeks
                if (t.status === 'scheduled') {
                    const startTime = new Date(t.start_time);
                    return validStatus && startTime <= twoWeeksFromNow;
                }
                
                return validStatus;
            });
            
            // Sort by start time so nearest tournaments appear first
            upcomingTournaments.sort((a, b) => {
                return new Date(a.start_time) - new Date(b.start_time);
            });
            
            // Limit to reasonable number (e.g., next 12 tournaments)
            realTournamentData = upcomingTournaments.slice(0, 12);
            
            console.log(`‚úÖ Loaded ${realTournamentData.length} tiered tournaments from database`);
            console.log(`üìÖ Showing tournaments starting within the next 2 weeks`);
            
            processTournamentData();
            renderTournamentsFromDatabase();
            showMainContent();
        } else {
            console.error('‚ùå Failed to load tournaments:', result.error);
            throw new Error(result.error || 'Failed to load tournaments');
        }
        
    } catch (error) {
        console.error('‚ùå Error loading tournaments:', error);
        showErrorState(error.message || 'Failed to load tournaments. Please try again.');
    } finally {
        isLoading = false;
    }
}

        function processTournamentData() {
            tournamentData = {};
            
            if (!realTournamentData || realTournamentData.length === 0) {
                console.log('‚ö†Ô∏è No tournament data to process');
                return;
            }
            
            realTournamentData.forEach((tournament, index) => {
                const template = tournament.tournament_templates || {
                    name: tournament.tournament_name || 'Tournament',
                    tournament_type: 'weekly',
                    trading_style: 'pure_wallet',
                    entry_fee: 0.01,
                    max_participants: 100,
                    prize_pool_percentage: 85
                };
                
                const metadata = tournament.deployment_metadata || {};
                const id = tournament.id || index + 1;
                
                const currentTime = new Date();
                const startTime = new Date(tournament.start_time);
                const registrationOpens = new Date(tournament.registration_opens || tournament.registration_opens_at || tournament.created_at);
                const registrationCloses = new Date(tournament.registration_closes || tournament.registration_closes_at || tournament.start_time);
                
                let actualStatus = tournament.status;
                if (actualStatus === 'scheduled' || actualStatus === 'upcoming') {
                    if (currentTime >= registrationOpens && currentTime < registrationCloses) {
                        actualStatus = 'registering';
                    }
                }
                
                // Get tier from metadata or derive from entry fee
                const tier = metadata.tier || getBracketFromEntryFee(template.entry_fee);
                const isMonthly = metadata.type === 'monthly_mega';
                
                tournamentData[id] = {
                    id: tournament.id,
                    templateId: tournament.template_id,
                    type: isMonthly ? 'monthly' : template.tournament_type || 'weekly',
                    tier: tier,
                    isMonthly: isMonthly,
                    registered: tournament.participant_count || 0,
                    maxPlayers: template.max_participants || 100,
                    entryFee: parseFloat(template.entry_fee || 0.01),
                    prizePool: parseFloat(tournament.total_prize_pool || 0),
                    duration: isMonthly ? '30 days' : '7 days',
                    title: metadata.baseVariantName || template.name || tournament.tournament_name || 'Unnamed Tournament',
                    tradingStyle: template.trading_style || 'pure_wallet',
                    startDay: template.start_day || 'variable',
                    status: actualStatus,
                    startTime: tournament.start_time,
                    endTime: tournament.end_time,
                    registrationOpens: tournament.registration_opens || tournament.registration_opens_at,
                    registrationCloses: tournament.registration_closes || tournament.registration_closes_at,
                    bracket: tier,
                    minParticipants: tournament.min_participants || 10,
                    metadata: metadata
                };
            });
            
            console.log(`‚úÖ Processed ${Object.keys(tournamentData).length} tiered tournaments`);
        }

        function renderTournamentsFromDatabase() {
            console.log('üé® Starting renderTournamentsFromDatabase for tiered system...');
            
            const grid = document.getElementById('tournamentsGrid');
            if (!grid) {
                console.error('‚ùå Tournament grid element not found!');
                return;
            }
            
            grid.innerHTML = '';
            
            if (!realTournamentData || realTournamentData.length === 0) {
                console.log('‚ö†Ô∏è No tournament data to render');
                grid.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #9ca3af; grid-column: 1 / -1;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üéÆ</div>
                        <div style="font-size: 1.2rem; margin-bottom: 0.5rem;">No tournaments available</div>
                        <div style="font-size: 0.9rem;">Check back later or refresh the page</div>
                        <button onclick="loadTournaments()" style="
                            margin-top: 1rem;
                            background: linear-gradient(135deg, #8b5cf6, #ec4899);
                            border: none;
                            color: white;
                            padding: 0.75rem 1.5rem;
                            border-radius: 0.75rem;
                            font-weight: 600;
                            cursor: pointer;
                        ">Refresh Tournaments</button>
                    </div>
                `;
                return;
            }
            
            let renderedCount = 0;
            realTournamentData.forEach((tournament, index) => {
                try {
                    const card = createTournamentCardFromData(tournament, index + 1);
                    if (card) {
                        grid.appendChild(card);
                        renderedCount++;
                    }
                } catch (error) {
                    console.error(`‚ùå Error rendering tournament ${index}:`, error);
                }
            });
            
            console.log(`‚úÖ Rendered ${renderedCount} tiered tournament cards`);
            applyAllFilters();
        }

        // Enhanced tournament card creation for tiered system
        function createTournamentCardFromData(tournament, displayId) {
            const template = tournament.tournament_templates || {
                name: tournament.tournament_name || 'Tournament',
                tournament_type: 'weekly',
                trading_style: 'pure_wallet',
                entry_fee: 0.01,
                max_participants: 100,
                start_day: 'variable'
            };
            
            const metadata = tournament.deployment_metadata || {};
            const card = document.createElement('div');
            
            // Get tier information from metadata
            const tier = metadata.tier || getBracketFromEntryFee(template.entry_fee);
            const tierConfig = window.TOURNAMENT_CONFIG?.weeklyTiers?.[tier];
            const isMonthly = metadata.type === 'monthly_mega';
            
            // Determine CSS classes for filtering
            const typeClass = isMonthly ? 'show-monthly' : `show-${template.tournament_type}`;
            const feeClass = getFeeClass(template.entry_fee);
            const tierClass = `show-${tier}`;
            const statusClass = `show-${tournament.status}`;
            const tradingStyleClass = `show-${template.trading_style}`;
            
            card.className = `tournament-card show-all ${typeClass} ${feeClass} ${tierClass} ${statusClass} ${tradingStyleClass}`;
            card.onclick = () => showTournamentDetails(displayId);
            
            // Get status display
            const statusInfo = getTournamentStatusInfo(tournament);
            
            // Enhanced display for tiered tournaments
            const displayName = metadata.baseVariantName || template.name || tournament.tournament_name || 'Tournament';
            const tierDisplayName = isMonthly ? 'MEGA' : tier.toUpperCase();
            const expectedPrizePool = metadata.expectedPrizePool || parseFloat(tournament.total_prize_pool || 0);
            const maxPrizePool = tierConfig ? 
                (tierConfig.entryFee * tierConfig.maxParticipants * (tierConfig.prizePoolPercentage / 100)) : 
                expectedPrizePool;
            
            // Calculate potential winner prize
            const winnerShare = isMonthly ? 25 : (tierConfig?.winnerShare || 50);
            const potentialWinnerPrize = maxPrizePool * (winnerShare / 100);
            
            card.innerHTML = `
                <div class="card-front">
                    <div class="tournament-header-compact">
                        <div>
                            <h3 class="tournament-title">${displayName}</h3>
                            <div class="tournament-subtitle">
                                <span class="tier-badge tier-${tier}" title="${tier.charAt(0).toUpperCase() + tier.slice(1)} Tier">
                                    ${tierDisplayName}
                                </span>
                                <span class="trading-badge ${template.trading_style}">
                                    ${template.trading_style === 'pure_wallet' ? 'üìä Pure Wallet' : '‚ö° Open Trading'}
                                </span>
                                <span class="schedule-badge">
                                    ${new Date(tournament.start_time).toLocaleDateString()}
                                </span>
                                ${isMonthly ? '<span class="monthly-badge">üèÜ MONTHLY</span>' : ''}
                            </div>
                        </div>
                        <div class="status-badge ${statusInfo.class}">${statusInfo.text}</div>
                    </div>
                    
                    <div class="key-info">
                        <div class="key-info-item">
                            <div class="key-info-label">Entry Fee</div>
                            <div class="key-info-value">${template.entry_fee} SOL</div>
                        </div>
                        <div class="key-info-item">
                            <div class="key-info-label">${expectedPrizePool > 0 ? 'Prize Pool' : 'Max Prize'}</div>
                            <div class="key-info-value">${(expectedPrizePool || maxPrizePool).toFixed(2)} SOL</div>
                        </div>
                        <div class="key-info-item">
                            <div class="key-info-label">Winner Gets</div>
                            <div class="key-info-value prize-highlight">~${potentialWinnerPrize.toFixed(1)} SOL</div>
                        </div>
                        <div class="key-info-item">
                            <div class="key-info-label">Players</div>
                            <div class="key-info-value">${tournament.participant_count || 0}/${template.max_participants || 100}</div>
                        </div>
                    </div>
                    
                    <div class="tap-hint">
                        Tap for details & registration ‚Ä¢ ${tierDisplayName} tier tournament
                    </div>
                </div>
            `;
            
            return card;
        }

        function getBracketFromEntryFee(entryFee) {
            const fee = parseFloat(entryFee);
            if (fee <= 0.01) return 'bronze';
            if (fee <= 0.05) return 'silver'; 
            if (fee <= 0.1) return 'gold';
            return 'diamond';
        }

     // Add this enhanced getTournamentStatusInfo function to tournaments.html
// It provides better status messages for scheduled tournaments

function getTournamentStatusInfo(tournament) {
    const currentTime = new Date();
    const startTime = new Date(tournament.start_time);
    const endTime = new Date(tournament.end_time);
    const registrationOpens = new Date(tournament.registration_opens || tournament.registration_opens_at);
    const registrationCloses = new Date(tournament.registration_closes || tournament.registration_closes_at);
    
    if (tournament.status === 'cancelled') {
        return { class: 'status-upcoming', text: 'Cancelled' };
    }
    
    if (tournament.status === 'complete') {
        return { class: 'status-upcoming', text: 'Complete' };
    }
    
    // ENHANCED: Show when registration opens for scheduled tournaments
    if (currentTime < registrationOpens) {
        const timeUntil = registrationOpens - currentTime;
        const hoursUntil = Math.floor(timeUntil / (1000 * 60 * 60));
        const daysUntil = Math.floor(hoursUntil / 24);
        
        if (daysUntil > 1) {
            return { 
                class: 'status-upcoming', 
                text: `Opens in ${daysUntil}d`,
                tooltip: `Registration opens ${registrationOpens.toLocaleDateString()} at ${registrationOpens.toLocaleTimeString()}`
            };
        } else if (hoursUntil > 1) {
            return { 
                class: 'status-upcoming', 
                text: `Opens in ${hoursUntil}h`,
                tooltip: `Registration opens at ${registrationOpens.toLocaleTimeString()}`
            };
        } else {
            const minutesUntil = Math.floor(timeUntil / (1000 * 60));
            return { 
                class: 'status-upcoming', 
                text: `Opens in ${minutesUntil}m`,
                tooltip: 'Registration opening soon!'
            };
        }
    }
    
    // ENHANCED: Show time remaining for registration
    if (currentTime >= registrationOpens && currentTime < registrationCloses) {
        const timeLeft = registrationCloses - currentTime;
        const hoursLeft = Math.floor(timeLeft / (1000 * 60 * 60));
        const daysLeft = Math.floor(hoursLeft / 24);
        
        if (daysLeft > 1) {
            return { 
                class: 'status-registering', 
                text: `Open (${daysLeft}d left)`,
                tooltip: `Registration closes ${registrationCloses.toLocaleDateString()} at ${registrationCloses.toLocaleTimeString()}`
            };
        } else if (hoursLeft > 1) {
            return { 
                class: 'status-registering', 
                text: `Open (${hoursLeft}h left)`,
                tooltip: `Registration closes at ${registrationCloses.toLocaleTimeString()}`
            };
        } else {
            const minutesLeft = Math.floor(timeLeft / (1000 * 60));
            return { 
                class: 'status-registering', 
                text: `Open (${minutesLeft}m left)`,
                tooltip: 'Registration closing soon!'
            };
        }
    }
    
    if (currentTime >= registrationCloses && currentTime < startTime) {
        const timeUntilStart = startTime - currentTime;
        const hoursUntilStart = Math.floor(timeUntilStart / (1000 * 60 * 60));
        
        if (hoursUntilStart > 1) {
            return { class: 'status-upcoming', text: `Starts in ${hoursUntilStart}h` };
        } else {
            const minutesUntilStart = Math.floor(timeUntilStart / (1000 * 60));
            return { class: 'status-upcoming', text: `Starts in ${minutesUntilStart}m` };
        }
    }
    
    if (currentTime >= startTime && currentTime < endTime) {
        return { class: 'status-active', text: 'Live' };
    }
    
    if (currentTime >= endTime) {
        return { class: 'status-upcoming', text: 'Ended' };
    }
    
    // Fallback
    return { class: 'status-upcoming', text: tournament.status };
}

        function getFeeClass(entryFee) {
            const fee = parseFloat(entryFee);
            if (fee <= 0.01) return 'show-low';
            if (fee <= 0.05) return 'show-medium';
            return 'show-high';
        }

        function capitalizeFirst(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        // ========================================
        // ENHANCED TOURNAMENT DETAILS FOR TIERS
        // ========================================

function showTournamentDetails(tournamentId) {
    // First, try to find the tournament in tournamentData
    let tournament = tournamentData[tournamentId];
    
    // If not found in tournamentData, search in realTournamentData by actual ID
    if (!tournament && realTournamentData) {
        const realTournament = realTournamentData.find(t => 
            t.id === tournamentId || 
            // Also check if tournamentId is just an index
            realTournamentData[tournamentId - 1] === t
        );
        
        if (realTournament) {
            // Create tournament object from real data
            tournament = {
                id: realTournament.id,
                title: realTournament.tournament_name || 'Tournament',
                entryFee: realTournament.deployment_metadata?.entry_fee || 
                         realTournament.tournament_templates?.entry_fee || 0.01,
                maxPlayers: realTournament.deployment_metadata?.max_participants || 
                           realTournament.tournament_templates?.max_participants || 100,
                registered: realTournament.participant_count || 0,
                minParticipants: realTournament.min_participants || 10,
                prizePool: realTournament.total_prize_pool || 0,
                tradingStyle: realTournament.deployment_metadata?.trading_style || 
                             realTournament.tournament_templates?.trading_style || 'pure_wallet',
                duration: '7 days',
                status: realTournament.status,
                startTime: realTournament.start_time,
                endTime: realTournament.end_time,
                registrationCloses: realTournament.registration_closes || realTournament.registration_closes_at,
                tier: realTournament.deployment_metadata?.tier || 'bronze',
                metadata: realTournament.deployment_metadata || {}
            };
        }
    }
    
    if (!tournament) {
        console.error(`Tournament ${tournamentId} not found in any data source`);
        alert('Tournament details not found. Please refresh the page and try again.');
        return;
    }
    
    // Rest of the function continues as before...
    const tournamentInstance = realTournamentData.find(t => t.id === tournament.id);
    if (!tournamentInstance) {
        console.error(`Tournament instance ${tournament.id} not found`);
        alert('Tournament details not available. Please refresh the page.');
        return;
    }
    
    const metadata = tournamentInstance.deployment_metadata || {};
    const tier = metadata.tier || tournament.tier || 'bronze';
    const isMonthly = metadata.type === 'monthly_mega';
    const tierConfig = window.TOURNAMENT_CONFIG?.weeklyTiers?.[tier];
    
    // Calculate prize breakdown
    const maxPrizePool = isMonthly ? metadata.expectedPrizePool : 
        (tierConfig ? tierConfig.entryFee * tierConfig.maxParticipants * (tierConfig.prizePoolPercentage / 100) : tournament.prizePool);
    const winnerShare = isMonthly ? 25 : (tierConfig?.winnerShare || 50);
    const winnerPrize = maxPrizePool * (winnerShare / 100);
    
    const walletStatus = window.getWalletStatus ? window.getWalletStatus() : { isConnected: false };
    
    // Create and show the modal (rest of the code remains the same)
    const modal = document.createElement('div');
    modal.className = 'tournament-registration-modal';
    modal.innerHTML = `
        <div class="modal-content">
            <h2>${tournament.title}</h2>
            
            <div class="tournament-tier-info">
                <div class="tier-display tier-${tier}">
                    <div class="tier-icon">${getTierIcon(tier, isMonthly)}</div>
                    <div class="tier-details">
                        <div class="tier-name">${tier.toUpperCase()} TIER${isMonthly ? ' - MONTHLY MEGA' : ''}</div>
                        <div class="tier-description">${getTierDescription(tier, isMonthly)}</div>
                    </div>
                </div>
            </div>
            
            <div class="tournament-info">
                <p><strong>Entry Fee:</strong> ${tournament.entryFee} SOL</p>
                <p><strong>Maximum Prize Pool:</strong> ${maxPrizePool.toFixed(2)} SOL (~$${(maxPrizePool * 150).toLocaleString()})</p>
                <p><strong>Winner Prize:</strong> ~${winnerPrize.toFixed(1)} SOL (~$${(winnerPrize * 150).toLocaleString()})</p>
                <p><strong>Participants:</strong> ${tournament.registered}/${tournament.maxPlayers} (Min: ${tournament.minParticipants})</p>
                <p><strong>Trading Style:</strong> ${tournament.tradingStyle === 'pure_wallet' ? 'üìä Pure Wallet Only' : '‚ö° Open Trading Allowed'}</p>
                <p><strong>Duration:</strong> ${isMonthly ? '30 days' : tournament.duration}</p>
                <p><strong>Status:</strong> ${getTournamentStatusInfo(tournamentInstance).text}</p>
                <p><strong>Start Time:</strong> ${new Date(tournament.startTime).toLocaleString()}</p>
                <p><strong>Registration Closes:</strong> ${new Date(tournament.registrationCloses).toLocaleString()}</p>
                ${metadata.theme ? `<p><strong>Theme:</strong> ${metadata.theme}</p>` : ''}
            </div>
            
            <div class="prize-breakdown">
                <h4>Prize Distribution</h4>
                <div class="prize-list">
                    ${generatePrizeBreakdown(maxPrizePool, isMonthly, tournament.registered || tournament.minParticipants)}
                </div>
            </div>
            
            ${!walletStatus.isConnected ? `
                <div class="warning-box">
                    <p>üîó Please connect your wallet to register for tournaments</p>
                </div>
            ` : tournament.status !== 'registering' && tournament.status !== 'scheduled' ? `
                <div class="warning-box">
                    <p>‚ö†Ô∏è Registration is not currently open for this tournament</p>
                </div>
            ` : `
                <div class="success-box">
                    <p>‚úÖ Ready to register as ${walletStatus.championName}</p>
                    <p>üí° ${tier.toUpperCase()} tier tournaments are ${getTierAdvice(tier)}</p>
                </div>
            `}
            
            <div class="registration-actions">
                <button onclick="closeRegistrationModal()">Close</button>
                ${walletStatus.isConnected && (tournament.status === 'registering' || tournament.status === 'scheduled') ? `
                    <button onclick="proceedToRegister('${tournament.id}', '${tournament.tradingStyle}', ${tournament.entryFee})" 
                            class="register-btn tier-${tier}">
                        Register (${tournament.entryFee} SOL)
                    </button>
                ` : ''}
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
}

        function closeRegistrationModal() {
    const modal = document.querySelector('.tournament-registration-modal');
    if (modal) {
        modal.remove();
    }
}

        function getTierIcon(tier, isMonthly) {
            if (isMonthly) return 'üèÜ';
            const icons = {
                bronze: 'ü•â',
                silver: 'ü•à', 
                gold: 'ü•á',
                diamond: 'üíé'
            };
            return icons[tier] || 'üéÆ';
        }

        function getTierDescription(tier, isMonthly) {
            if (isMonthly) return 'Ultimate monthly championship with massive prizes';
            
            const descriptions = {
                bronze: 'Perfect entry point for new traders',
                silver: 'Intermediate level with solid rewards',
                gold: 'High-stakes competition for serious traders',
                diamond: 'Elite tier for trading masters'
            };
            return descriptions[tier] || 'Competitive tournament';
        }

        function getTierAdvice(tier) {
            const advice = {
                bronze: 'perfect for beginners and learning',
                silver: 'great for developing your skills',
                gold: 'ideal for experienced traders',
                diamond: 'for elite traders seeking top rewards'
            };
            return advice[tier] || 'exciting and competitive';
        }

        function generatePrizeBreakdown(totalPrize, isMonthly, participants) {
            const config = window.TOURNAMENT_CONFIG?.prizeDistribution;
            if (!config) return '<p>Prize breakdown unavailable</p>';
            
            let distribution;
            if (isMonthly) {
                distribution = config.mega.distribution;
            } else if (participants >= 100) {
                distribution = config.large.distribution;
            } else if (participants >= 50) {
                distribution = config.medium.distribution;
            } else {
                distribution = config.small.distribution;
            }
            
            let html = '';
            distribution.forEach((percentage, index) => {
                const prize = totalPrize * (percentage / 100);
                const place = index + 1;
                const medal = place === 1 ? 'ü•á' : place === 2 ? 'ü•à' : place === 3 ? 'ü•â' : 'üèÜ';
                html += `
                    <div class="prize-item">
                        <span class="place">${medal} ${getOrdinal(place)} Place</span>
                        <span class="prize">${prize.toFixed(2)} SOL</span>
                        <span class="percentage">${percentage}%</span>
                    </div>
                `;
            });
            
            return html;
        }

        function getOrdinal(num) {
            const suffixes = ['th', 'st', 'nd', 'rd'];
            const value = num % 100;
            return num + (suffixes[(value - 20) % 10] || suffixes[value] || suffixes[0]);
        }

       async function proceedToRegister(tournamentId, tradingStyle, entryFee) {
    const walletStatus = window.getWalletStatus();
    
    if (!walletStatus.isConnected || !walletStatus.championId) {
        alert('‚ùå Wallet connection lost. Please reconnect your wallet.');
        closeRegistrationModal();
        return;
    }

    // Check if escrow integration is available
    if (!window.WalletWarsEscrowIntegration || !window.solana) {
        alert('‚ö†Ô∏è Tournament Registration Unavailable\n\nThe escrow payment system is currently being set up. Please check back later to register for tournaments.\n\nEntry fees will be collected via secure Solana escrow contracts.');
        return;
    }
    
    try {
        console.log(`üéÆ Registering for tournament ${tournamentId} with escrow payment...`);
        
        // Initialize escrow client
        const escrow = new WalletWarsEscrowIntegration(window.solana);
        
        // Show payment confirmation
        const confirmPayment = confirm(
            `‚ö†Ô∏è Tournament Registration\n\n` +
            `Entry Fee: ${entryFee} SOL\n\n` +
            `This payment will be processed through the WalletWars escrow system.\n\n` +
            `‚úÖ If minimum participants are reached: Prize pool distributed to winners\n` +
            `‚ùå If minimum participants NOT reached: Full refund will be issued\n\n` +
            `Proceed with registration?`
        );
        
        if (!confirmPayment) {
            return;
        }
        
        // Show loading state
        const loadingAlert = document.createElement('div');
        loadingAlert.innerHTML = `
            <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                        background: rgba(31, 41, 55, 0.95); border: 2px solid #8b5cf6; 
                        border-radius: 1rem; padding: 2rem; z-index: 10000; text-align: center;">
                <div class="loading-spinner" style="margin: 0 auto 1rem;"></div>
                <div style="color: #8b5cf6; font-weight: 600;">Processing Payment...</div>
                <div style="color: #9ca3af; font-size: 0.9rem; margin-top: 0.5rem;">Please approve the transaction in your wallet</div>
            </div>
        `;
        document.body.appendChild(loadingAlert);
        
        try {
            // Register with escrow (this handles the payment)
            const escrowResult = await escrow.registerPlayer(tournamentId);
            
            if (escrowResult.success) {
                // Payment successful, now update the database
                const result = await window.walletWarsAPI.registerForTournament(
                    walletStatus.championId,
                    tournamentId,
                    tradingStyle
                );
                
                if (result.success) {
                    document.body.removeChild(loadingAlert);
                    alert(
                        `üéâ Registration Successful!\n\n` +
                        `‚úÖ Entry fee of ${entryFee} SOL has been paid to escrow\n` +
                        `üìã Transaction: ${escrowResult.signature.slice(0, 8)}...${escrowResult.signature.slice(-8)}\n\n` +
                        `Good luck in the tournament!`
                    );
                    closeRegistrationModal();
                    setTimeout(() => loadTournaments(), 1000);
                } else {
                    document.body.removeChild(loadingAlert);
                    alert(
                        `‚ö†Ô∏è Registration Issue\n\n` +
                        `Your payment was successful but database registration failed.\n` +
                        `Error: ${result.error}\n\n` +
                        `‚ö†Ô∏è IMPORTANT: Your entry fee has been paid. Please contact support with this transaction:\n` +
                        `${escrowResult.signature}`
                    );
                }
            } else {
                document.body.removeChild(loadingAlert);
                alert(`‚ùå Payment Failed\n\n${escrowResult.error}\n\nNo funds have been deducted from your wallet.`);
            }
        } catch (error) {
            if (loadingAlert.parentNode) {
                document.body.removeChild(loadingAlert);
            }
            throw error;
        }
        
    } catch (error) {
        console.error('‚ùå Registration error:', error);
        alert(
            `‚ùå Registration Failed\n\n` +
            `${error.message}\n\n` +
            `If you believe this is an error, please contact support.`
        );
    }
}

        // ========================================
        // ENHANCED FILTER FUNCTIONS FOR TIERS
        // ========================================

        function toggleFilters() {
            const filterContent = document.getElementById('filterContent');
            const filterToggle = document.querySelector('.filter-toggle');
            
            filterContent.classList.toggle('active');
            filterToggle.classList.toggle('active');
        }

        function filterByTier(tier) {
            currentFilter.tier = tier;
            updateFilterButtons('.tier-filter-buttons .filter-btn', tier);
            applyAllFilters();
        }

        function filterByTradingStyle(style) {
            currentFilter.tradingStyle = style;
            updateFilterButtons('.filter-group:nth-child(2) .filter-btn', style);
            applyAllFilters();
        }

        function filterByFee(fee) {
            currentFilter.fee = fee;
            updateFilterButtons('.filter-group:nth-child(3) .filter-btn', fee);
            applyAllFilters();
        }

        function filterByStatus(status) {
            currentFilter.status = status;
            updateFilterButtons('.filter-group:nth-child(4) .filter-btn', status);
            applyAllFilters();
        }

        function updateFilterButtons(selector, value) {
            const buttons = document.querySelectorAll(selector);
            buttons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.toLowerCase().includes(value) || 
                    (value === 'all' && btn.textContent.toLowerCase().includes('all'))) {
                    btn.classList.add('active');
                }
            });
        }

        function applyAllFilters() {
            const cards = document.querySelectorAll('.tournament-card');
            
            cards.forEach(card => {
                let show = true;
                
                // Tier filter
                if (currentFilter.tier !== 'all') {
                    const hasTier = card.classList.contains('show-' + currentFilter.tier);
                    if (!hasTier) show = false;
                }
                
                // Trading style filter
                if (currentFilter.tradingStyle !== 'all') {
                    const hasStyle = card.classList.contains('show-' + currentFilter.tradingStyle);
                    if (!hasStyle) show = false;
                }
                
                // Fee filter
                if (currentFilter.fee !== 'all') {
                    const hasFee = card.classList.contains('show-' + currentFilter.fee);
                    if (!hasFee) show = false;
                }
                
                // Status filter
                if (currentFilter.status !== 'all') {
                    const hasStatus = card.classList.contains('show-' + currentFilter.status);
                    if (!hasStatus) show = false;
                }
                
                card.style.display = show ? 'block' : 'none';
            });
        }

        // ========================================
        // UI STATE MANAGEMENT
        // ========================================

        function showLoadingState() {
            document.getElementById('loadingState').style.display = 'flex';
            document.getElementById('errorState').style.display = 'none';
            document.getElementById('mainContent').style.display = 'none';
        }

        function showErrorState(message) {
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('errorState').style.display = 'flex';
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('errorMessage').textContent = message;
        }

        function showMainContent() {
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('errorState').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
        }

        function createDemoTournamentIfNeeded() {
            try {
                console.log('üèóÔ∏è Creating demo tiered tournaments...');
                
                if (window.TieredTournamentDeploymentManager) {
                    const deploymentManager = new window.TieredTournamentDeploymentManager();
                    deploymentManager.deployUpcomingTournaments().then(() => {
                        console.log('‚úÖ Demo tiered tournaments created, reloading...');
                        setTimeout(() => loadTournaments(), 2000);
                    });
                    return;
                }
                
                showSetupInstructions();
                
            } catch (error) {
                console.error('‚ùå Failed to create demo tournaments:', error);
                showSetupInstructions();
            }
        }

        function showSetupInstructions() {
            const grid = document.getElementById('tournamentsGrid');
            grid.innerHTML = `
                <div style="text-align: center; padding: 3rem; color: #9ca3af; grid-column: 1 / -1;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üöÄ</div>
                    <div style="font-size: 1.2rem; margin-bottom: 1rem; color: #8b5cf6;">Tiered Tournament System Setup Required</div>
                    <div style="font-size: 0.9rem; margin-bottom: 2rem; max-width: 500px; margin-left: auto; margin-right: auto;">
                        Your enhanced tiered tournament system with Bronze ‚Üí Silver ‚Üí Gold ‚Üí Diamond progression and monthly mega tournaments needs to be configured. Please run the setup process to initialize the escalating stakes system.
                    </div>
                    <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                        <button onclick="window.open('setup.html', '_blank')" style="
                            background: linear-gradient(135deg, #8b5cf6, #ec4899);
                            border: none;
                            color: white;
                            padding: 0.75rem 1.5rem;
                            border-radius: 0.75rem;
                            font-weight: 600;
                            cursor: pointer;
                        ">Open Tiered Setup</button>
                        <button onclick="loadTournaments()" style="
                            background: rgba(31, 41, 55, 0.5);
                            border: 1px solid rgba(139, 92, 246, 0.3);
                            color: #d1d5db;
                            padding: 0.75rem 1.5rem;
                            border-radius: 0.75rem;
                            cursor: pointer;
                        ">Retry Loading</button>
                    </div>
                </div>
            `;
            showMainContent();
        }

   // ========================================
// ENHANCED INITIALIZATION WITH TIERED SYSTEM
// ========================================

document.addEventListener('DOMContentLoaded', function() {
    // Initialize mobile navigation
    initializeMobileNavigation();
    handleWindowResize();
    
    console.log('üéÆ WalletWars Tiered Tournaments page loading...');
    
    // Check for GlobalWalletManager connection immediately
    const hasConnection = checkGlobalWalletConnection();
    if (hasConnection) {
        console.log('‚úÖ GlobalWalletManager connection restored on tournaments page');
    }
    
    // Enhanced API loading with better timeout handling
    let initAttempts = 0;
    const maxAttempts = 15;
    
    function tryLoadTournaments() {
        initAttempts++;
        console.log(`‚è≥ Checking tiered APIs... (${initAttempts}/${maxAttempts})`);
        
        // Check for required APIs
        const hasWalletWarsAPI = !!window.walletWarsAPI;
        const hasGlobalWalletManager = !!window.globalWalletManager;
        const hasTieredConfig = !!window.TOURNAMENT_CONFIG;
        const hasTieredSelector = !!window.TieredTournamentSelector;
        const hasTieredDeployment = !!window.TieredTournamentDeploymentManager;
        const hasWeb3 = !!window.solanaWeb3;
        
        console.log(`üìä Tiered API Status: WalletWarsAPI=${hasWalletWarsAPI}, GlobalWalletManager=${hasGlobalWalletManager}, TieredConfig=${hasTieredConfig}, TieredSelector=${hasTieredSelector}, TieredDeployment=${hasTieredDeployment}, Web3=${hasWeb3}`);
        
        if (hasWalletWarsAPI && hasGlobalWalletManager && hasWeb3 && hasTieredConfig) {
            console.log('‚úÖ Core tiered APIs ready, loading tournaments...');
            
            // Give systems a moment to initialize
            setTimeout(() => {
                loadTournaments();
            }, 1000);
            
        } else if (initAttempts < maxAttempts) {
            setTimeout(tryLoadTournaments, 1000);
        } else {
            console.warn('‚ö†Ô∏è Tiered APIs not ready after timeout, attempting to load anyway...');
            
            if (hasWalletWarsAPI) {
                loadTournaments();
            } else {
                showSetupInstructions();
            }
        }
    }
    
    // Start the loading process
    tryLoadTournaments();
    
    // Refresh tournament data every 30 seconds
    setInterval(function() {
        if (!isLoading && window.walletWarsAPI) {
            console.log('üîÑ Auto-refreshing tiered tournament data...');
            loadTournaments();
        }
    }, 30000);
});
            
// ========================================
        // ADMIN TOURNAMENT CREATION SYSTEM
        // ========================================
        
        // Admin functionality
        const ADMIN_WALLET = '6PoB9i9kpumDze7EhiL3CicAuEPxDAzrTVzHYot9sx9h';
        const ESCROW_PROGRAM = 'AXMwpemCzKXiozQhcMtxajPGQwiz4SWfb3xvH42RXuT7';
        const PLATFORM_WALLET = '5RLDuPHsa7ohaKUSNc5iYvtgveL1qrCcVdxVHXPeG3b8';

        let isAdminMode = false;

        // Check if admin wallet is connected
        function checkAdminAccess() {
            const walletStatus = window.getWalletStatus ? window.getWalletStatus() : { isConnected: false };
            
            if (walletStatus.isConnected && walletStatus.walletAddress === ADMIN_WALLET) {
                console.log('üëë Admin wallet detected');
                document.getElementById('adminModeToggle').style.display = 'block';
                return true;
            }
            
            document.getElementById('adminModeToggle').style.display = 'none';
            document.getElementById('adminCreateSection').style.display = 'none';
            isAdminMode = false;
            return false;
        }

        // Toggle admin mode
        function toggleAdminMode() {
            if (!checkAdminAccess()) return;
            
            isAdminMode = !isAdminMode;
            document.getElementById('adminModeStatus').textContent = isAdminMode ? 'ON' : 'OFF';
            document.getElementById('adminCreateSection').style.display = isAdminMode ? 'block' : 'none';
            
            console.log(`üëë Admin mode: ${isAdminMode ? 'ON' : 'OFF'}`);
        }

        // Show create tournament modal
        function showCreateTournamentModal() {
            if (!checkAdminAccess()) {
                alert('‚ùå Admin access required');
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'admin-modal';
            modal.id = 'createTournamentModal';
            
            // Calculate suggested dates
            const now = new Date();
            const registrationOpens = new Date(now.getTime() + 5 * 60000); // 5 minutes from now
            const registrationCloses = new Date(now.getTime() + 24 * 60 * 60000); // 24 hours from now
            const startTime = new Date(now.getTime() + 24 * 60 * 60000); // 24 hours from now
            const endTime = new Date(now.getTime() + 8 * 24 * 60 * 60000); // 8 days from now
            
            modal.innerHTML = `
                <div class="admin-modal-content">
                    <h2>Create New Tournament</h2>
                    
                    <form id="createTournamentForm" onsubmit="handleCreateTournament(event)">
                        <div class="form-group">
                            <label>Tournament Name</label>
                            <input type="text" name="name" required placeholder="e.g., Weekly Trading Championship">
                        </div>
                        
                        <div class="form-group">
                            <label>Tournament Tier</label>
                            <div class="tier-selector">
                                <div class="tier-option" onclick="selectTier('bronze', 0.01)" data-tier="bronze">
                                    <div class="tier-icon">ü•â</div>
                                    <div class="tier-name">Bronze</div>
                                    <div class="tier-fee">0.01 SOL</div>
                                </div>
                                <div class="tier-option" onclick="selectTier('silver', 0.05)" data-tier="silver">
                                    <div class="tier-icon">ü•à</div>
                                    <div class="tier-name">Silver</div>
                                    <div class="tier-fee">0.05 SOL</div>
                                </div>
                                <div class="tier-option" onclick="selectTier('gold', 0.1)" data-tier="gold">
                                    <div class="tier-icon">ü•á</div>
                                    <div class="tier-name">Gold</div>
                                    <div class="tier-fee">0.1 SOL</div>
                                </div>
                                <div class="tier-option" onclick="selectTier('diamond', 0.25)" data-tier="diamond">
                                    <div class="tier-icon">üíé</div>
                                    <div class="tier-name">Diamond</div>
                                    <div class="tier-fee">0.25 SOL</div>
                                </div>
                            </div>
                            <input type="hidden" name="tier" id="selectedTier" required>
                            <input type="hidden" name="entryFee" id="selectedEntryFee" required>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Trading Style</label>
                                <select name="tradingStyle" required>
                                    <option value="pure_wallet">Pure Wallet</option>
                                    <option value="open_trading">Open Trading</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Tournament Type</label>
                                <select name="tournamentType" required>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly Mega</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Max Participants</label>
                                <input type="number" name="maxParticipants" required value="100" min="10" max="1000">
                            </div>
                            
                            <div class="form-group">
                                <label>Min Participants</label>
                                <input type="number" name="minParticipants" required value="10" min="2" max="50">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Prize Pool Percentage</label>
                            <input type="number" name="prizePoolPercentage" required value="85" min="50" max="100" step="5">
                            <small style="color: #9ca3af;">Percentage of entry fees that go to prize pool</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Registration Opens</label>
                            <input type="datetime-local" name="registrationOpens" required value="${formatDateTimeLocal(registrationOpens)}">
                        </div>
                        
                        <div class="form-group">
                            <label>Registration Closes</label>
                            <input type="datetime-local" name="registrationCloses" required value="${formatDateTimeLocal(registrationCloses)}">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Tournament Starts</label>
                                <input type="datetime-local" name="startTime" required value="${formatDateTimeLocal(startTime)}">
                            </div>
                            
                            <div class="form-group">
                                <label>Tournament Ends</label>
                                <input type="datetime-local" name="endTime" required value="${formatDateTimeLocal(endTime)}">
                            </div>
                        </div>
                        
                        <div class="info-box">
                            <p>‚ÑπÔ∏è The tournament will be created with the correct escrow PDA addresses. Players will pay entry fees directly to the escrow program at ${ESCROW_PROGRAM}</p>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn-cancel" onclick="closeCreateTournamentModal()">Cancel</button>
                            <button type="submit" class="btn-create">Create Tournament</button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Close create tournament modal
        function closeCreateTournamentModal() {
            const modal = document.getElementById('createTournamentModal');
            if (modal) {
                modal.remove();
            }
        }

        // Select tournament tier
        function selectTier(tier, entryFee) {
            // Update UI
            document.querySelectorAll('.tier-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`[data-tier="${tier}"]`).classList.add('selected');
            
            // Update hidden inputs
            document.getElementById('selectedTier').value = tier;
            document.getElementById('selectedEntryFee').value = entryFee;
        }

   // Handle tournament creation
async function handleCreateTournament(event) {
    event.preventDefault();
    
    if (!checkAdminAccess()) {
        alert('‚ùå Admin access required');
        return;
    }
    
    const form = event.target;
    const formData = new FormData(form);
    
    // Validate tier selection
    if (!formData.get('tier') || !formData.get('entryFee')) {
        alert('Please select a tournament tier');
        return;
    }
    
    try {
        console.log('üéÆ Creating tournament...');
        
        // First, check if we should create a template
        const createTemplate = confirm('Would you like to save this as a reusable template?\n\nYes = Can be used for automation\nNo = One-time tournament only');
        
        let templateId = null;
        let templateData = null;
        
        if (createTemplate) {
            // Create a template first
            const templateName = formData.get('name') + ' Template';
            templateData = {
                name: templateName,
                tournament_type: formData.get('tournamentType'),
                trading_style: formData.get('tradingStyle'),
                start_day: 'variable', // Admin templates are flexible
                entry_fee: parseFloat(formData.get('entryFee')),
                max_participants: parseInt(formData.get('maxParticipants')),
                min_participants: parseInt(formData.get('minParticipants')),
                prize_pool_percentage: parseInt(formData.get('prizePoolPercentage')),
                is_active: true
            };
            
            const templateResult = await window.walletWarsAPI.createTournamentTemplate(templateData);
            
            if (templateResult.success) {
                console.log('‚úÖ Template created:', templateResult.template.id);
                templateId = templateResult.template.id;
                // Store the full template data for the tournament
                templateData = templateResult.template;
            } else {
                console.warn('‚ö†Ô∏è Template creation failed, continuing without template');
            }
        }
        
        // Calculate times
        const startTime = new Date(formData.get('startTime'));
        const endTime = new Date(formData.get('endTime'));
        const registrationOpens = new Date(formData.get('registrationOpens'));
        const registrationCloses = new Date(formData.get('registrationCloses'));
        
        // Create tournament data
        const tournamentData = {
            tournament_name: formData.get('name'),
            status: 'scheduled',
            start_time: startTime.toISOString(),
            end_time: endTime.toISOString(),
            registration_opens: registrationOpens.toISOString(),
            registration_closes: registrationCloses.toISOString(),
            participant_count: 0,
            min_participants: parseInt(formData.get('minParticipants')),
            total_prize_pool: 0,
            // Add these for compatibility
            registration_opens_at: registrationOpens.toISOString(),
            registration_closes_at: registrationCloses.toISOString(),
            // Include template_id if we created one
            template_id: templateId,
            // Always include deployment metadata
            deployment_metadata: {
                tier: formData.get('tier'),
                type: formData.get('tournamentType'),
                baseVariantName: formData.get('name'),
                expectedPrizePool: calculateExpectedPrizePool(
                    parseFloat(formData.get('entryFee')),
                    parseInt(formData.get('maxParticipants')),
                    parseInt(formData.get('prizePoolPercentage'))
                ),
                entry_fee: parseFloat(formData.get('entryFee')),
                max_participants: parseInt(formData.get('maxParticipants')),
                prize_pool_percentage: parseInt(formData.get('prizePoolPercentage')),
                trading_style: formData.get('tradingStyle'),
                tournament_type: formData.get('tournamentType'),
                createdBy: ADMIN_WALLET,
                createdAt: new Date().toISOString(),
                manuallyCreated: true,
                hasTemplate: !!templateId
            }
        };
        
        // If no template was created, add template data directly for display
        if (!templateId) {
            tournamentData.tournament_templates = {
                name: formData.get('name'),
                tournament_type: formData.get('tournamentType'),
                trading_style: formData.get('tradingStyle'),
                entry_fee: parseFloat(formData.get('entryFee')),
                max_participants: parseInt(formData.get('maxParticipants')),
                prize_pool_percentage: parseInt(formData.get('prizePoolPercentage'))
            };
        }
        
        // Create tournament
        const result = await window.walletWarsAPI.createTournamentInstance(tournamentData);
        
        if (result.success) {
            let message = `‚úÖ Tournament created successfully!\n\nTournament ID: ${result.instance.id}`;
            
            if (templateId) {
                message += `\n\nüìã Template created! This tournament configuration can now be used for automation.`;
            }
            
            alert(message);
            closeCreateTournamentModal();
            
            // Schedule lifecycle events if automation is available
            if (window.tournamentLifecycleManager && result.instance) {
                try {
                    const deploymentManager = new window.TournamentDeploymentManager();
                    await deploymentManager.scheduleLifecycleEvents(result.instance);
                    console.log('‚è∞ Lifecycle events scheduled for tournament');
                } catch (error) {
                    console.warn('‚ö†Ô∏è Could not schedule lifecycle events:', error);
                }
            }
            
            // Reload tournaments
            setTimeout(() => {
                loadTournaments();
            }, 1000);
        } else {
            throw new Error(result.error || 'Failed to create tournament');
        }
        
    } catch (error) {
        console.error('‚ùå Error creating tournament:', error);
        alert(`‚ùå Failed to create tournament: ${error.message}`);
    }
}

        // Generate unique tournament ID
        function generateTournamentId() {
            const timestamp = Date.now();
            const random = Math.floor(Math.random() * 10000);
            return `TOUR_${timestamp}_${random}`;
        }

        // Calculate escrow PDA (simplified - in production, use actual Solana Web3.js)
        async function calculateEscrowPDA(tournamentId) {
            // This is a simplified version - in production, you'd use:
            // const [pda] = await PublicKey.findProgramAddress(
            //     [Buffer.from('escrow'), Buffer.from(tournamentId)],
            //     new PublicKey(ESCROW_PROGRAM)
            // );
            
            // For now, return a mock PDA
            const hash = btoa(tournamentId + ESCROW_PROGRAM).replace(/[^a-zA-Z0-9]/g, '');
            return hash.substring(0, 44);
        }

        // Calculate expected prize pool
        function calculateExpectedPrizePool(entryFee, maxParticipants, prizePoolPercentage) {
            return (entryFee * maxParticipants * prizePoolPercentage) / 100;
        }

       // Format datetime for input
function formatDateTimeLocal(date) {
    const d = new Date(date);
    const year = d.getFullYear();
    const month = String(d.getMonth() + 1).padStart(2, '0');
    const day = String(d.getDate()).padStart(2, '0');
    const hours = String(d.getHours()).padStart(2, '0');
    const minutes = String(d.getMinutes()).padStart(2, '0');
    
    return `${year}-${month}-${day}T${hours}:${minutes}`;
}
        // Check admin access on wallet connection change
        if (window.globalWalletManager) {
            // Override the updateAllPagesUI to check admin access
            const originalUpdate = window.globalWalletManager.updateAllPagesUI.bind(window.globalWalletManager);
            window.globalWalletManager.updateAllPagesUI = function() {
                originalUpdate();
                checkAdminAccess();
            };
        }

        // Check admin access on page load
        setTimeout(() => {
            checkAdminAccess();
        }, 1000);

        // Check admin access periodically
        setInterval(() => {
            checkAdminAccess();
        }, 5000);

        console.log('üëë Admin tournament creation system loaded');
        
        // Simple wallet connection for non-index pages
        function attemptQuickConnect() {
            if (window.globalWalletManager) {
                // Try to connect with Phantom by default
                window.connectWallet('phantom').then(success => {
                    if (success) {
                        alert('Wallet connected! Please visit the home page to complete champion setup.');
                        window.location.href = 'index.html';
                    }
                }).catch(error => {
                    alert('Failed to connect wallet. Please try from the home page.');
                    window.location.href = 'index.html';
                });
            } else {
                window.location.href = 'index.html';
            }
        }

        // Override the connect button behavior
        document.addEventListener('DOMContentLoaded', function() {
            const connectBtn = document.querySelector('#connectWalletBtn a');
            if (connectBtn) {
                connectBtn.onclick = function(e) {
                    e.preventDefault();
                    attemptQuickConnect();
                };
            }
        });
       
        // Expose loadTournaments globally
        window.loadTournaments = loadTournaments || async function() {
            console.log('üîÑ Loading tournaments...');
            // The function will be defined by the existing script
        };

// Fix initialization after everything loads
            console.log("DEBUG: Reached end of main script");
        window.addEventListener('load', function() {
            console.log('üöÄ Page fully loaded, initializing tournaments...');
            
            // Give other scripts time to load
            setTimeout(function() {
                if (window.tournamentSystemStatus && !window.tournamentSystemStatus.ready) {
                    console.log('‚è≥ Waiting for tournament system...');
                    window.retryInitialization(10, 1000).then(function(success) {
                        if (success && window.loadTournaments) {
                            window.loadTournaments();
                        }
                    });
                } else if (window.loadTournaments) {
                    window.loadTournaments();
                }
            }, 500);
        });
              
    </script>
</body>
</html>
